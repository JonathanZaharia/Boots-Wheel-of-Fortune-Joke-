<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Boot Gameshow — Ultimate Version</title>
<style>
  :root{
    --bg:#031021; --card:#0e1724; --accent:#ffd166; --muted:#b6c0cc;
    --danger:#f94144; --win:#90be6d;
  }
  *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#020515,#071428);color:#eef6ff}
  .wrap{max-width:1200px;margin:18px auto;padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 18px 60px rgba(2,6,23,0.7)}
  header{display:flex;align-items:center;gap:12px}
  h1{margin:0;font-size:20px}
  .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
  .btn{background:var(--accent);border:0;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
  .smallBtn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:6px 10px;border-radius:8px;color:var(--muted);cursor:pointer}
  .stage{display:flex;gap:16px;margin-top:14px;flex-wrap:wrap;align-items:flex-start}
  #left{flex:0 1 540px;display:flex;flex-direction:column;align-items:center}
  canvas{border-radius:12px;background:linear-gradient(180deg, rgba(0,0,0,0.08), rgba(0,0,0,0.02));box-shadow:0 12px 34px rgba(0,0,0,0.6)}
  #spinRow{display:flex;gap:10px;margin-top:10px;align-items:center}
  .lights{height:8px;margin-top:12px;display:flex;gap:6px;justify-content:center}
  .bulb{width:12px;height:12px;border-radius:50%;background:#222}
  #right{flex:1;min-width:300px}
  .hostLine{font-weight:800;color:#fff;margin-bottom:8px}
  .panel{background:rgba(255,255,255,0.02);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
  .options{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px;margin-top:10px}
  .option{display:flex;gap:8px;align-items:center;padding:6px;border-radius:8px;cursor:pointer;border:1px solid rgba(255,255,255,0.02);background:rgba(255,255,255,0.01)}
  .option img{width:56px;height:56px;object-fit:cover;border-radius:8px;flex-shrink:0}
  .optTitle{font-weight:700;font-size:13px}
  .optMeta{font-size:12px;color:var(--muted)}
  #winnerModal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);min-width:320px;background:#071428;padding:14px;border-radius:12px;z-index:100;display:none;box-shadow:0 32px 80px rgba(0,0,0,0.6)}
  #winnerModal.show{display:block;animation:pop .3s ease-out}
  @keyframes pop{from{transform:translate(-50%,-50%) scale(.95);opacity:0}to{transform:translate(-50%,-50%) scale(1);opacity:1}}
  #miniCrew{position:fixed;right:12px;bottom:12px;z-index:30;display:flex;gap:6px}
  .miniguy{width:28px;height:28px;border-radius:6px;background:#ffd166;display:flex;align-items:center;justify-content:center;transform-origin:center;animation:wiggle 1.2s infinite}
  @keyframes wiggle{0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}
  /* main character */
  #actorWrap{position:fixed;left:20px;bottom:20px;width:120px;height:140px;z-index:40;pointer-events:none}
  .actor{width:120px;height:120px;border-radius:14px;background:linear-gradient(180deg,#ffd166,#ff9f43);display:flex;align-items:center;justify-content:center;box-shadow:0 12px 30px rgba(0,0,0,0.5);transform-origin:center;transition:transform .08s}
  .actor .face{width:72px;height:52px;position:relative}
  .eye{width:12px;height:12px;background:#031018;border-radius:50%;position:absolute;top:12px;transition:transform .06s}
  .eye.r{right:6px}
  .eye.l{left:6px}
  .mouth{position:absolute;left:50%;transform:translateX(-50%);bottom:6px;width:36px;height:10px;border-radius:10px;background:#031018}
  /* small dancing sprites */
  .dancers{position:fixed;left:60%;top:6%;display:flex;gap:8px;z-index:25}
  .dancer{width:22px;height:30px;background:#9b59b6;border-radius:4px;animation:dance .9s infinite}
  @keyframes dance{0%{transform:translateY(0)}50%{transform:translateY(-8px) rotate(-6deg)}100%{transform:translateY(0)}}
  /* sidefeed */
  #feed{height:200px;overflow:auto;margin-top:10px;background:rgba(255,255,255,0.012);padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);font-size:13px}
  .feedItem{padding:6px;border-bottom:1px dashed rgba(255,255,255,0.02)}
  /* rigging secret */
  #title{cursor:pointer}
  /* small mini-game overlay */
  #miniGame{position:fixed;left:50%;top:80%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.6);padding:8px;border-radius:8px;color:#fff;display:none;z-index:80}
  #miniGame.show{display:block}
  @media(max-width:800px){ .stage{flex-direction:column} #left{width:100%} }
</style>
</head>
<body>
  <div class="wrap" role="application" aria-label="Boot Gameshow">
    <header>
      <h1 id="title">THE BOOT SPINNING GAMESHOW</h1>
      <div class="controls">
        <div id="voiceSwitch" style="display:flex;gap:6px;">
          <button class="smallBtn" data-voice="retro">Retro</button>
          <button class="smallBtn" data-voice="villain">Villain</button>
          <button class="smallBtn" data-voice="youtuber">YouTuber</button>
        </div>
        <button class="btn" id="rulesBtn">How to Play</button>
      </div>
    </header>

    <div class="stage">
      <div id="left">
        <div class="lights" id="lights" aria-hidden="true"></div>
        <canvas id="wheel" width="520" height="520" aria-label="Spin the wheel"></canvas>
        <div id="spinRow">
          <button id="spinBtn" class="btn">SPIN THE WHEEL</button>
          <button id="rigBtn" class="smallBtn">RIG (secret)</button>
          <div id="spinCount" style="color:var(--muted);font-size:13px;margin-left:6px">Spins: 0</div>
        </div>
      </div>

      <div id="right">
        <div class="hostLine" id="hostLine">Welcome. Choose your voice and spin.</div>
        <div class="panel">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:800">Options</div>
            <div style="font-size:12px;color:var(--muted)">Click thumbnails to open buy links</div>
          </div>

          <div id="options" class="options" aria-live="polite"></div>

          <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
            <div style="font-weight:700">Live Feed</div>
            <div style="color:var(--muted);font-size:12px;margin-left:auto">Fake sales & activity</div>
          </div>
          <div id="feed"></div>
        </div>

        <div style="height:10px"></div>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="smallBtn" id="toggleRoast">Toggle Roasts</button>
          <button class="smallBtn" id="toggleConfetti">Confetti On</button>
          <button class="smallBtn" id="spinAgainSmall">Spin Again</button>
        </div>
      </div>
    </div>
  </div>

  <div id="winnerModal" aria-hidden="true">
    <div style="display:flex;gap:12px;align-items:center">
      <img id="winImg" src="" alt="winner" style="width:160px;height:120px;object-fit:cover;border-radius:8px"/>
      <div>
        <h2 id="winTitle" style="margin:0">YOU WON</h2>
        <div id="winPrice" style="color:var(--muted);margin-top:6px"></div>
        <div style="margin-top:10px">
          <button id="buyBtn" class="btn">BUY</button>
          <button id="closeWin" class="smallBtn">Close</button>
        </div>
      </div>
    </div>
  </div>

  <div id="miniCrew" aria-hidden="true">
    <!-- small animated dudes -->
  </div>

  <div id="actorWrap" aria-hidden="true">
    <div id="actor" class="actor" title="Gremlin Boot">
      <div class="face">
        <div class="eye l"></div>
        <div class="eye r"></div>
        <div class="mouth"></div>
      </div>
    </div>
  </div>

  <div id="miniGame">
    <div id="miniText">Secret rig challenge active! Click the boot 5 times to win...</div>
    <button id="miniAction" class="smallBtn">Click me</button>
  </div>

<script>
/* ========= CONFIG ========== */
const options = [
  { label: "Baobab – Bronco Brown", price: "$199.99", img: "assets/baobab.jpg", url: "https://jimgreenfootwear.com/store/baobab-boot-bronco/?attribute_pa_size=12", value:199.99 },
  { label: "African Ranger – Leather Midsole – Bronco Brown", price: "$169.99", img: "assets/ar-bronco-leather.jpg", url: "https://jimgreenfootwear.com/store/african-ranger-bronco-leather-midsole/?attribute_pa_size=12", value:169.99 },
  { label: "African Ranger – Leather Midsole – Houston Brown", price: "$155.99", img: "assets/ar-houston-leather.jpg", url: "https://jimgreenfootwear.com/store/african-ranger-houston-brown-leather-midsole/?attribute_pa_size=12", value:155.99 },
  { label: "African Ranger – Bronco Brown (Tyre Wedge)", price: "$155.99", img: "assets/ar-tyre.jpg", url: "https://jimgreenfootwear.com/store/african-ranger-tyre-wedge-bronco/?attribute_pa_size=12", value:155.99 },
  { label: "719 – Frog Grip Sole – Bronco Brown", price: "$129.99", img: "assets/719-frog.jpg", url: "https://jimgreenfootwear.com/store/719-bronco/", value:129.99 },
  { label: "719 – Tyre Wedge – Bronco Brown", price: "$129.99", img: "assets/719-tyre.jpg", url: "https://jimgreenfootwear.com/store/719-bronco-brown-tyre-wedge/", value:129.99 },
  { label: "African Ranger – Buffalo Skin", price: "$240.00", img: "assets/ar-buffalo.jpg", url: "https://jimgreenfootwear.com/store/african-ranger-buffalo-skin/", value:240.00 },
  { label: "African Ranger – Leather Midsole – Buffalo", price: "$240.00", img: "assets/ar-buffalo-leather.jpg", url: "https://jimgreenfootwear.com/store/african-ranger-buffalo-leather-midsole/", value:240.00 }
];

let voiceMode = 'retro';
let roastEnabled = true;
let confettiEnabled = true;
let spinCounter = 0;
let secretClicks = 0;
let rigSecret = false;

/* ====== PRELOAD IMAGES ====== */
const preloaded = {};
function preloadAll(){
  const ps = options.map(o=>new Promise(res=>{
    const img = new Image();
    img.onload=()=>{ preloaded[o.img]=img; res(true); };
    img.onerror=()=>{ preloaded[o.img]=null; res(false); };
    img.src=o.img;
  }));
  return Promise.all(ps);
}

/* ====== WHEEL DRAW (images on slices) ====== */
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const dpr = window.devicePixelRatio||1;
canvas.width = canvas.clientWidth * dpr;
canvas.height = canvas.clientHeight * dpr;
ctx.scale(dpr,dpr);
const cx = canvas.clientWidth/2, cy = canvas.clientHeight/2;
const outerR = Math.min(cx,cy)-8, innerR = 60;
let angle = 0, vel = 0, spinning=false;
const arc = Math.PI*2 / options.length;
const colors = ["#c0392b","#e67e22","#f1c40f","#2ecc71","#1abc9c","#3498db","#9b59b6","#e84393"];

function draw(){
  ctx.clearRect(0,0,canvas.clientWidth,canvas.clientHeight);
  const maxVal = Math.max(...options.map(o=>o.value));
  for(let i=0;i<options.length;i++){
    const start = angle + i*arc;
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,outerR,start,start+arc); ctx.closePath();
    ctx.fillStyle = colors[i%colors.length]; ctx.globalAlpha = 0.9 + (options[i].value/maxVal)*0.2; ctx.fill(); ctx.globalAlpha =1;
    // cut inner
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,innerR,start,start+arc,true); ctx.closePath(); ctx.globalCompositeOperation='destination-out'; ctx.fill(); ctx.globalCompositeOperation='source-over';
    // draw image clipped
    const mid = start + arc/2;
    const img = preloaded[options[i].img];
    ctx.save();
    const imgX = cx + Math.cos(mid)*(innerR+outerR)/2*0.6;
    const imgY = cy + Math.sin(mid)*(innerR+outerR)/2*0.6;
    ctx.translate(imgX,imgY);
    ctx.rotate(mid + Math.PI/2);
    if(img){
      const w=68, h=68;
      ctx.drawImage(img, -w/2, -h/2, w, h);
    } else {
      ctx.fillStyle='rgba(0,0,0,0.2)'; ctx.fillRect(-28,-28,56,56);
    }
    ctx.restore();
  }
  // center
  ctx.beginPath(); ctx.arc(cx,cy,innerR-8,0,Math.PI*2); ctx.fillStyle="#031018"; ctx.fill();
  // pointer
  ctx.beginPath(); ctx.moveTo(cx, cy-outerR-6); ctx.lineTo(cx-18, cy-outerR+20); ctx.lineTo(cx+18, cy-outerR+20); ctx.closePath(); ctx.fillStyle='#ffd166'; ctx.fill();
  // label
  ctx.fillStyle='#fff'; ctx.font='700 16px sans-serif'; ctx.textAlign='center'; ctx.fillText('SPIN',cx,cy+6);
}

function animate(){
  if(spinning){
    vel *= 0.992;
    if(Math.abs(vel) < 0.0006){ vel = 0; spinning=false; setTimeout(onStop, 300); }
    angle += vel;
  }
  draw();
  requestAnimationFrame(animate);
}

function spin(){
  if(spinning) return;
  if(rigSecret){
    // visual look rigged but actual still fair unless we set a target
    const power = 0.35 + Math.random()*0.6;
    vel = power * (Math.random()>0.5?1:-1);
  } else {
    const power = 0.35 + Math.random()*0.6;
    vel = power * (Math.random()>0.5?1:-1);
  }
  spinning=true; drumroll(true); spinCounter++; updateSpinCount();
  speak(randomHostLine());
}

/* ==== selection & announce ==== */
function getIndex(){
  const normalized = ((angle % (Math.PI*2)) + Math.PI*2) % (Math.PI*2);
  const relative = (-Math.PI/2 - normalized + Math.PI*2) % (Math.PI*2);
  return Math.floor(relative / arc);
}

function onStop(){
  const idx = getIndex();
  const opt = options[idx];
  if(!opt) return;
  flashSlice(idx);
  announce(opt);
}

/* visuals */
function flashSlice(i){
  ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,outerR, angle + i*arc, angle + (i+1)*arc); ctx.closePath();
  ctx.fillStyle='rgba(255,255,255,0.12)'; ctx.fill();
  setTimeout(draw,420);
}

/* ===== host voices & lines ===== */
const hostLines = {
  retro: [
    "Ladies and gentlemen, spin for glory!",
    "This is retro night — spin like it's 1986!",
    "Put your fate on the wheel and let's see what you get."
  ],
  villain: [
    "Spin… and face the consequences.",
    "Your indecision is delicious. Spin.",
    "Let fate punish you—spin the wheel."
  ],
  youtuber: [
    "YO! Smash that spin button! Let's gooo!",
    "BRUH you waited FOUR years? Spin! Spin! Spin!",
    "This is insane — who will get roasted?"
  ]
};

const winnerLines = {
  retro: ["A splendid choice! What a classic boot.","Marvelous! Treat your feet right."],
  villain: ["Ah — the prize chooses you. Poor soul.","A luxurious fate. Do not squander it."],
  youtuber: ["OH SNAP — big flex! Buy it!","Absolute banger of a boot!"]
};

const roastLines = {
  retro: ["Budget option. How quaint.","A modest pick; your wallet nods."],
  villain: ["How pedestrian. I expected more.","Pathetic. This is your bravado?"],
  youtuber: ["Lowkey broke energy, not gonna lie.","Oof — big yikes, low-tier boot."]
};

function speak(text){
  if(!window.speechSynthesis) return;
  const u = new SpeechSynthesisUtterance(text);
  // try to select matching voice
  const voices = window.speechSynthesis.getVoices();
  if(voiceMode==='retro'){ u.rate=0.95; u.pitch=1.0; }
  if(voiceMode==='villain'){ u.rate=0.9; u.pitch=0.7; }
  if(voiceMode==='youtuber'){ u.rate=1.12; u.pitch=1.3; }
  // pick suitable voice if available
  const prefer = (voiceMode==='villain') ? 'Google UK English Male' : (voiceMode==='retro'?'Google US English':'Google UK English Female');
  const found = voices.find(v=>v.name.includes(prefer));
  if(found) u.voice = found;
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(u);
}

/* drumroll & sting */
let audioCtx=null;
function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
let drumInterval=null;
function drumroll(start){
  ensureAudio();
  const ctx = audioCtx;
  if(start){
    let i=0;
    drumInterval = setInterval(()=>{
      const o = ctx.createOscillator(), g=ctx.createGain();
      o.type='square'; o.frequency.value = 700 - (i*8);
      g.gain.value = 0.0006;
      o.connect(g); g.connect(ctx.destination);
      o.start(); o.stop(ctx.currentTime + 0.05);
      i++;
      if(i>28) i=28;
    }, 60);
  } else {
    if(drumInterval){ clearInterval(drumInterval); drumInterval=null; }
    // winner sting
    const o1 = audioCtx.createOscillator(), o2 = audioCtx.createOscillator(), g = audioCtx.createGain();
    o1.type='sine'; o2.type='sine'; o1.frequency.value = 1100; o2.frequency.value = 1600;
    g.gain.value = 0.0009; o1.connect(g); o2.connect(g); g.connect(audioCtx.destination);
    o1.start(); o2.start(); g.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.45);
    o1.stop(audioCtx.currentTime + 0.5); o2.stop(audioCtx.currentTime + 0.5);
  }
}
function drumrollStart(){ drumroll(true); setTimeout(()=>drumroll(false), 1600); }

/* announce result */
function announce(opt){
  const modal = document.getElementById('winnerModal');
  document.getElementById('winImg').src = opt.img;
  document.getElementById('winTitle').textContent = opt.label;
  document.getElementById('winPrice').textContent = opt.price;
  modal.classList.add('show'); modal.setAttribute('aria-hidden','false');
  // choose a line
  const winArr = winnerLines[voiceMode] || winnerLines.retro;
  const line = winArr[Math.floor(Math.random()*winArr.length)];
  setTimeout(()=>{ speak(line + " " + opt.label); drumroll(false); }, 350);
  if(confettiEnabled) runConfetti(opt);
  // roast if low price
  const min = Math.min(...options.map(o=>o.value));
  if(opt.value <= min*1.05 && roastEnabled){
    setTimeout(()=> speak(roastLines[voiceMode][Math.floor(Math.random()*roastLines[voiceMode].length)]), 1200);
  }
}

/* confetti */
function runConfetti(opt){
  const c = document.createElement('div'); c.style.position='fixed'; c.style.left=0; c.style.top=0; c.style.width='100%'; c.style.height='100%'; c.style.pointerEvents='none'; c.style.zIndex=90; document.body.appendChild(c);
  const cols = ['#ffd166','#f94144','#90be6d','#577590','#f8961e'];
  for(let i=0;i<80;i++){ const el=document.createElement('div'); el.style.position='absolute'; el.style.width='10px'; el.style.height='14px'; el.style.background=cols[i%cols.length]; el.style.left=Math.random()*100 + '%'; el.style.top='-5%'; el.style.opacity=Math.random()*0.9+0.2; el.style.transform=`rotate(${Math.random()*360}deg)`; el.style.borderRadius='2px'; el.style.transition=`transform 2.2s linear, top 2.2s linear, left 2.2s linear, opacity 2.2s linear`; c.appendChild(el); setTimeout(()=>{ el.style.top = 100 + Math.random()*10 + '%'; el.style.left = (Math.random()*80 + 10) + '%'; el.style.transform = `rotate(${Math.random()*720}deg)`; el.style.opacity = 0; }, 50 + Math.random()*300); }
  setTimeout(()=> c.remove(), 3000);
}

/* UI building */
function buildOptions(){
  const wrap = document.getElementById('options'); wrap.innerHTML='';
  const vals = options.map(o=>o.value); const max = Math.max(...vals), min = Math.min(...vals);
  options.forEach((o,i)=>{
    const div = document.createElement('div'); div.className='option';
    div.innerHTML = `<img src="${o.img}" alt="${o.label}"><div><div class="optTitle">${o.label}</div><div class="optMeta">${o.price} • <span style="font-weight:700">${(o.value>=max*0.85)?'High Roller':(o.value<=min*1.05?'Bottom Dollar':'Mid')}</span></div></div>`;
    div.addEventListener('click', ()=> window.open(o.url,'_blank'));
    wrap.appendChild(div);
  });
}

/* live feed */
const feed = document.getElementById('feed');
const sampleNames = ["AnonymousBuyer","CartCrusher","SneakySam","BootFanatic","OfficeTony","NoGiftNick","LateLarry"];
const feedProducts = options.map(o=>o.label);
function pushFeed(msg){
  const el = document.createElement('div'); el.className='feedItem'; el.textContent = msg; feed.prepend(el);
  if(feed.children.length>24) feed.removeChild(feed.lastChild);
}
function randomFeedTick(){
  const who = sampleNames[Math.floor(Math.random()*sampleNames.length)];
  const prod = feedProducts[Math.floor(Math.random()*feedProducts.length)];
  const price = (Math.random()>0.6)?'used' : '$'+(Math.floor(Math.random()*80)+99);
  pushFeed(`${who} just bought ${prod} — ${price}`);
}
setInterval(randomFeedTick, 4200);

/* lights & dancers & mini crew */
function startLights(){
  const lights = document.getElementById('lights'); lights.innerHTML='';
  for(let i=0;i<18;i++){ const b = document.createElement('div'); b.className='bulb'; lights.appendChild(b); }
  setInterval(()=>{ document.querySelectorAll('.bulb').forEach((b)=>{ const on=Math.random()>0.6; b.style.background = on ? '#ffd166' : '#222'; b.style.boxShadow = on ? '0 4px 14px rgba(255,209,102,0.45)' : 'none'; }); }, 420);
  const crew = document.getElementById('miniCrew'); for(let i=0;i<9;i++){ const d=document.createElement('div'); d.className='miniguy'; d.style.background = ['#ffd166','#f94144','#90be6d','#577590','#f8961e'][i%5]; crew.appendChild(d); }
  const dancers = document.createElement('div'); dancers.className='dancers'; for(let i=0;i<6;i++){ const dd=document.createElement('div'); dd.className='dancer'; dd.style.background=['#9b59b6','#3498db','#f8961e','#ffd166','#2ecc71','#e84393'][i%6]; dancers.appendChild(dd); } document.body.appendChild(dancers);
}

/* actor follows cursor */
const actor = document.getElementById('actor');
let actorX = 20, actorY = 20;
document.addEventListener('mousemove', (e)=>{
  const ax = e.clientX, ay = e.clientY;
  // move actor toward cursor (but limited)
  const wrap = document.getElementById('actorWrap');
  wrap.style.left = Math.max(8, Math.min(window.innerWidth - 140, ax - 60)) + 'px';
  wrap.style.bottom = Math.max(8, Math.min(window.innerHeight - 80, window.innerHeight - ay - 40)) + 'px';
  // eyes follow a bit
  const eyes = document.querySelectorAll('.eye');
  eyes.forEach((eye, idx)=>{
    const dx = (ax - (wrap.getBoundingClientRect().left + 60))/30;
    const dy = (ay - (wrap.getBoundingClientRect().top + 60))/30;
    eye.style.transform = `translate(${Math.max(-6,Math.min(6,dx))}px, ${Math.max(-3,Math.min(3,dy))}px)`;
  });
});

/* spin / controls wiring */
document.getElementById('spinBtn').addEventListener('click', ()=>{ spin(); drumrollStart(); });
document.getElementById('spinAgainSmall').addEventListener('click', ()=> spin());
document.getElementById('toggleRoast').addEventListener('click', ()=>{ roastEnabled = !roastEnabled; document.getElementById('toggleRoast').textContent = roastEnabled ? 'Toggle Roasts' : 'Roasts OFF'; });
document.getElementById('toggleConfetti').addEventListener('click', ()=>{ confettiEnabled = !confettiEnabled; document.getElementById('toggleConfetti').textContent = confettiEnabled ? 'Confetti On' : 'Confetti OFF'; });

/* voice buttons */
document.querySelectorAll('#voiceSwitch .smallBtn').forEach(b=>{
  b.addEventListener('click', ()=>{
    voiceMode = b.getAttribute('data-voice');
    document.querySelectorAll('#voiceSwitch .smallBtn').forEach(x=>x.style.opacity=0.5); b.style.opacity=1;
    speak(randomHostLine());
  });
});
document.getElementById('rulesBtn').addEventListener('click', ()=> alert("Spin the wheel. When it stops, the host will reveal the winner. Click BUY to open the product page. Click the title 7 times for a secret."));

/* winner modal buttons */
document.getElementById('buyBtn').addEventListener('click', ()=> {
  const idx = getIndex();
  const o = options[idx];
  if(o) window.open(o.url,'_blank');
});
document.getElementById('closeWin').addEventListener('click', ()=> {
  document.getElementById('winnerModal').classList.remove('show');
});

/* rig button & secret via title clicks */
document.getElementById('rigBtn').addEventListener('click', ()=> {
  rigSecret = !rigSecret;
  document.getElementById('rigBtn').textContent = rigSecret ? 'RIG ON' : 'RIG (secret)';
});
document.getElementById('title').addEventListener('click', ()=>{
  secretClicks++;
  if(secretClicks>=7){ secretClicks=0; rigSecret = true; document.getElementById('miniGame').classList.add('show'); document.getElementById('miniText').textContent='Rig unlock! Click the button 5 times to guarantee a winner.'; }
});
let miniCount=0;
document.getElementById('miniAction').addEventListener('click', ()=>{
  miniCount++;
  if(miniCount>=5){ document.getElementById('miniText').textContent='Rigged spin enabled for next spin!'; rigSecret=true; setTimeout(()=> document.getElementById('miniGame').classList.remove('show'),1200); miniCount=0; }
});

/* spin counter update */
function updateSpinCount(){ document.getElementById('spinCount').textContent = 'Spins: ' + spinCounter; }

/* feedback small hack: if rigSecret true, we make the spin more likely to hit a specific index (choose expensive) */
function spinWithRig(){
  // Not used directly; we keep fairness visually but if rigSecret true after spin we bias the final slow-phase angle
}

/* init */
preloadAll().then(()=>{
  buildOptions();
  draw();
  animate();
  startLights();
  // default voice button style
  document.querySelectorAll('#voiceSwitch .smallBtn').forEach(x=>x.style.opacity=0.5);
  document.querySelector('#voiceSwitch .smallBtn[data-voice="retro"]').style.opacity=1;
  // initial feed entries
  for(let i=0;i<6;i++) randomFeedTick();
});
</script>
</body>
</html>
